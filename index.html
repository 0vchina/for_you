<div id="debugInfo" style="
  position: absolute;
  top: 10px;
  left: 10px;
  padding: 10px;
  background: rgba(0, 0, 0, 0.8);
  color: yellow;
  font-family: monospace;
  font-size: 14px;
  white-space: pre-line;
  z-index: 999;
">
  GPS: инициализация...
</div>

<a-scene
  vr-mode-ui="enabled: false"
  embedded
  arjs="sourceType: webcam; trackingMethod: best;"
>
  <a-camera gps-camera rotation-reader></a-camera>

  <a-entity
    id="targetModel"
    gltf-model="model.glb"
    gps-entity-place="latitude: 52.153400; longitude: 26.195200;"
    scale="3 3 3"
    rotation="0 180 0"
    visible="false"
  ></a-entity>
</a-scene>

<script>
const debugInfo = document.getElementById('debugInfo');
const model = document.getElementById('targetModel');

// Точка активации (где пользователь должен оказаться, чтобы модель появилась)
const entryLat = 52.1534551;
const entryLon = 26.1951000;
const entryDistance = 15; // метров

let modelActivated = false;

function computeDistance(lat1, lon1, lat2, lon2) {
  const R = 6371000;
  const toRad = deg => deg * Math.PI / 180;
  const dLat = toRad(lat2 - lat1);
  const dLon = toRad(lon2 - lon1);
  const a =
    Math.sin(dLat / 2) ** 2 +
    Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
    Math.sin(dLon / 2) ** 2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
  return R * c;
}

navigator.geolocation.watchPosition(
  pos => {
    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;

    const distance = computeDistance(lat, lon, entryLat, entryLon);

    debugInfo.innerText =
      `Ваши координаты:\n${lat.toFixed(6)}, ${lon.toFixed(6)}\n` +
      `До точки входа: ${distance.toFixed(1)} м\n`;

    if (!modelActivated && distance <= entryDistance) {
      model.setAttribute('visible', true);
      modelActivated = true;
      debugInfo.innerText += '\nМодель активирована!';
    }

    if (modelActivated && distance > entryDistance + 5) {
      model.setAttribute('visible', false);
      modelActivated = false;
      debugInfo.innerText += '\nВы вышли из зоны — модель скрыта.';
    }
  },
  err => {
    console.error('Ошибка GPS:', err);
    debugInfo.innerText = `Ошибка GPS:\n${err.message}`;
  },
  { enableHighAccuracy: true }
);
</script>
