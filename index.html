navigator.geolocation.watchPosition(
  pos => {
    if (modelLocked) return;

    const lat = pos.coords.latitude;
    const lon = pos.coords.longitude;
    const accuracy = pos.coords.accuracy;

    if (accuracy > 20) {
      debugInfo.innerText =
        `Ваши координаты:\n${lat.toFixed(6)}, ${lon.toFixed(6)}\n` +
        `Точность слишком низкая: ${accuracy.toFixed(1)} м\n` +
        'Ожидание сигнала GPS...';
      return;
    }

    const distance = computeDistance(lat, lon, benchLat, benchLon);

    debugInfo.innerText =
      `Ваши координаты:\n${lat.toFixed(6)}, ${lon.toFixed(6)}\n` +
      `Точность: ${accuracy.toFixed(1)} м\n` +
      `До лавочки: ${distance.toFixed(1)} м\n` +
      'Ожидание...';

    if (distance <= appearDistance) {
      const target = computeDestination(benchLat, benchLon, modelDistance, benchBearing);
      const offset = computeOffset(lat, lon, target.lat, target.lon);
      const smooth = getSmoothedPosition(offset);
      model.setAttribute('position', `${smooth.x} 0 ${smooth.z}`);
      model.setAttribute('visible', true);

      if (positionBuffer.length >= bufferSize) {
        modelLocked = true;
        debugInfo.innerText += '\nМодель зафиксирована!';
        console.log("Модель установлена по направлению лавочки:", smooth);
      }
    } else {
      model.setAttribute('visible', false);
      positionBuffer.length = 0;
    }
  },
  err => {
    console.error('Ошибка GPS:', err);
    debugInfo.innerText = `Ошибка GPS:\n${err.message}`;
  },
  { enableHighAccuracy: true }
);
